import pyvisa
import time
import numpy as np
import csv

# Crea il Resource Manager
rm = pyvisa.ResourceManager()

# Mostra tutti gli strumenti trovati
print(rm.list_resources())

# Connessione al VNA (modifica con l'indirizzo del tuo strumento)
vna = rm.open_resource("TCPIP0::193.206.156.99::inst0::INSTR")

# Imposta il timeout (in ms)
vna.timeout = 10000

# Identificazione dello strumento
print(vna.query("*IDN?"))


vna.write("INST:SEL 'NA';*WAI")
vna.write("CALC:PAR:DEF S21;*WAI")
vna.write("SENS:FREQ:STAR 1E9;*WAI")
vna.write("SENS:FREQ:STOP 2E9;*WAI")
vna.write("SENS:SWE:POIN 101;*WAI")
vna.write("INIT:IMM;*WAI")

while True:
    if int(vna.query("*OPC?").strip()) == 1:
        break
    time.sleep(0.1)
    



# Chiudi la connessione quando hai finito
vna.close()

